<!doctype html>
<html>
<head>
<title>Demo</title>
  <link rel="stylesheet" type="text/css" href="index.css"/>
  <script type="text/javascript" src="roslite.bundle.js"></script>
  <script type="text/javascript" src="imuNode.js"></script>
  <script type="text/javascript" src="gpsNode.js"></script>
</head>
<body>

<div id="console"></div>

<script>
// "rostopic echo /gps/fix"
(()=>{
  let nh = ros.initNode("echo_gps");
  let onData = (msg) => {
    console.log("recevied gps message:", msg);
    print("Received GPS message:", "#0080cc");
    print(json2html(msg));
  };
  nh.subscribe("/gps/fix", "sensor_msgs/NavSatFix", onData);
})();

// "rostopic echo /imu/data"
(()=>{
  let nh = ros.initNode("echo_imu");
  let onData = (msg) => {
    console.log("recevied imu message:", msg);
    print("Received IMU message:", "#0080cc");
    print(json2html(msg));
  };
  nh.subscribe("/imu/data", "sensor_msgs/Imu", onData);
})();

let json2html = function(msg) {
    return JSON.stringify(msg, null, 2).replace(/\n/sg, "<br>").replace(/ /sg, "&nbsp;");
}

let print = function(text, color) {
  if(!color) color = "#ffffff";
  let html = '<span style="color:' + color + '">' + text + '</span><br>';
  let console = document.getElementById('console');
  if(console.innerHTML.length > 1048576) console.innerHTML = "";
  console.innerHTML += html;
  console.scrollTop = console.scrollHeight;
}

</script>

</body>
</html>
